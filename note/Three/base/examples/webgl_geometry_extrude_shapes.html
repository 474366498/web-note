<!DOCTYPE html>
<html lang='en'>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
  <title>Document</title>
  </head>
  <style>
    body{
      margin:0;
    }
  </style>
  <body>
     <script async src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>

  <script type="importmap">
    {
      "imports" : {
        "three" :"../../three/build/three.module.js" ,
        "plugins/":"../../three/jsm/"
      }
    }
  </script>
  <script type="module" >
    import * as T from 'three' 
    import {OrbitControls } from 'plugins/controls/OrbitControls.js'
    import { TrackballControls } from 'plugins/controls/TrackballControls.js'
    console.log(T , OrbitControls)

    var camera , webgl , scene , controls 
    // let a = 1;
    // function fn() {
    //   let a = 2;
    //   // 这里写代码，使得最后的打印是3
    //   (0, eval)('a+2')
    // }
    // fn();
    // console.log(561, a); // 3


    init ()
    animation() 

    function init () {
      webgl = new T.WebGLRenderer({antialias:true})
      webgl.setPixelRatio(window.devicePixelRatio)
      webgl.setSize(window.innerWidth,window.innerHeight)
      document.body.appendChild(webgl.domElement)

      scene = new T.Scene()
      scene.background = new T.Color(0x222222)

      camera = new T.PerspectiveCamera(45,window.innerWidth / window.innerHeight,1,1000)
      camera.position.set(0,0,500) 

      controls = new TrackballControls(camera , webgl.domElement) 
      controls.minDistance = 200 
      controls.maxDistance = 500

      // scene.add(new T.AxesHelper(5e2))
      scene.add(new T.AmbientLight(0x222222)) 
      const light = new T.PointLight(0xffffff)
      light.position.copy(camera.position) 
      scene.add(light)
      
      const closedSpline = new T.CatmullRomCurve3([
        new T.Vector3( - 60, - 100, 60 ),
        new T.Vector3( - 60, 20, 60 ),
        new T.Vector3( - 60, 120, 60 ),
        new T.Vector3( 60, 20, - 60 ),
        new T.Vector3( 60, - 100, - 60 )
      ])
      closedSpline.curveType = 'catmullrom'
      closedSpline.closed = true 

      const extrudeSettings1 = {
        steps : 1e2 ,
        bevelEnabled : false ,
        extrudePath : closedSpline
      }

      const pts1 = [] , count = 3 
      for(let i = 0 ; i < count ; i++) {
        const l = 20 , a = ((2 * i) / count) * Math.PI 
        pts1.push(new T.Vector2(Math.cos(a) *l , Math.sin(a) * l))
      }
      const shape1 = new T.Shape(pts1) 
      const geometry1 = new T.ExtrudeGeometry(shape1,extrudeSettings1) 
      const material1 = new T.MeshLambertMaterial({color:0xb00000 , wireframe : false}) 
      const mesh1 = new T.Mesh(geometry1,material1)
      scene.add(mesh1)

      const randomPoints = [] 
      for(let i = 0 ; i < 10 ; i++) {
        randomPoints.push(new T.Vector3( ( i - 4.5 ) * 50, T.MathUtils.randFloat( - 50, 50 ), T.MathUtils.randFloat( - 50, 50 ) )
        )
      }
      const randomSpline = new T.CatmullRomCurve3(randomPoints)

      const extrudeSettings2 = {
        steps : 200 ,
        bevelEnabled : false ,
        extrudePath : randomSpline
      }

      const pts2 = [] , numPts = 5 
      for(let i = 0 ; i< numPts * 2 ; i++) {
        const l = i % 2 == 1 ? 10 : 20 
        const a = i / numPts * Math.PI 
        pts2.push(new T.Vector2( Math.cos(a) * l , Math.sin(a) * l ))
      }


      const shape2 = new T.Shape(pts2) 
      const geometry2 = new T.ExtrudeGeometry(shape2 , extrudeSettings2) 
      const material2 = new T.MeshLambertMaterial({color : 0xff8000,wireframe:false})
      const mesh2 = new T.Mesh(geometry2,material2)
      scene.add(mesh2)





      const materials = [ material1 , material2 ] 
      const extrudeSetting3 = {
        depth : 20 ,
        steps : 1 ,
        bevelEnabled : true ,
        bevelThickness : 2 ,
        bevelSize : 4 ,
        bevelSegments : 1 
      }

      const geometry3 = new T.ExtrudeGeometry(shape2,extrudeSetting3) 
      const mesh3 = new T.Mesh(geometry3,materials) 
      mesh3.position.set(50,100,50)
      scene.add(mesh3)
    
    }

    function animation () {
      requestAnimationFrame(animation)
      controls.update()
      webgl.render(scene,camera)
    }


  </script>
  </body>
  
</html>