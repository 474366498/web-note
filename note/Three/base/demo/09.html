<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<style>
  body{
    margin:0;
  }
</style>
<body>
  
</body>

<script type="importmap">
  
  {
    "imports" : {
      "three" : "../../three/build/three.module.js" ,
      "plugins/":"../../three/jsm/"
    }
  }
</script>

<script type="module">
  import * as T from 'three' 
  import { OrbitControls } from 'plugins/controls/OrbitControls.js'

  console.log(T , OrbitControls);

  const scene = new T.Scene() 

  for(let i = 0 ; i < 5;i++) {
    let group = new T.Group()
    group.name = `group-${i+1}` 
    for(let j = 0;j < 6; j++) {
      let geo = j % 2 === 0 ? new T.BoxGeometry(50,50,50) : new T.CylinderGeometry(30,50,50,24) 
      let material = new T.MeshLambertMaterial({
        color : j % 2 === 0 ? 0xff0000 : 0xffff00
      })
      let mesh = new T.Mesh(geo,material) 
      mesh.name = `mesh-${j+1}` 
      mesh.position.set(j*100 + 25 ,50 ,i*100 + 50)
      group.add(mesh)
    }
    scene.add(group)
  }
  
  const spot = new T.SpotLight(0xffffff) 
  spot.position.set(600,600,500)
  const targetObj = new T.Object3D()
  targetObj.position.set(300,0,250)
  console.log(55,targetObj)
  spot.target = targetObj
  // spot.angle = Math.PI/2
  scene.add(spot) 
  
  const spotHelper = new T.SpotLightHelper(spot)
  scene.add(spotHelper)



  const axes = new T.AxesHelper(1e3) 
  scene.add(axes) 

  const camera = new T.PerspectiveCamera(45,window.innerWidth / window.innerHeight ,.1 , 3e3) 
  camera.position.set(5e2,5e2,5e2) 
  camera.lookAt(0,0,0) 

  const webgl = new T.WebGLRenderer({antialias:true }) 
  webgl.setSize(window.innerWidth , window.innerHeight)
  webgl.setClearColor(0x444444) 
  webgl.setPixelRatio(window.devicePixelRatio)

  webgl.render(scene,camera) 
  console.log(webgl , scene)
  document.body.appendChild(webgl.domElement)

  let flg = true
  wiggle()
  function wiggle (){
    if(spot.angle > Math.PI / 2) {
      flg = false 
    }else if(spot.angle <= 0){
      flg = true
    }
    if(flg) {
      spot.angle += Math.PI / 360
    }else{
      spot.angle -= Math.PI / 360
    }
    // console.log(spot.angle)
    spotHelper.update()
    webgl.render(scene,camera)
    requestAnimationFrame(wiggle)
  }


  const orbit = new OrbitControls(camera,webgl.domElement)
  orbit.addEventListener('change',()=>{
    webgl.render(scene,camera)
  })

  // scene.traverse(function (item) {
  //   console.log(103,item,'场景',item.isScene, '组合',item.isGroup,'网格',item.isMesh,'name',item.name)
  //   let v3Position = new T.Vector3() 
  //   item.getWorldPosition(v3Position)
  //   console.log(106,'worldPosition',v3Position)
  // })

</script>

</html>